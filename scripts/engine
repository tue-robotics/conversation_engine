#! /usr/bin/env python

# System
import argparse

# ROS
import rospy
from robocup_knowledge import knowledge_loader

# Conversation engine
from conversation_engine import ConversationEngine


if __name__ == "__main__":
    rospy.init_node("conversation_engine")

    robot = rospy.get_param("robot", "amigo")
    grammar = rospy.get_param("grammar", None)
    command_target = rospy.get_param("command_target", None)
    challenge = rospy.get_param("challenge", "challenge_gpsr")

    grammar = ""
    command_target = ""

    if grammar and not command_target:
        rospy.logerr("A grammar was specified without a command_target")
        exit(-1)
    elif not grammar and command_target:
        rospy.logerr("A command_target was specified without a grammar")
        exit(-1)
    elif not challenge:
        rospy.logerr("Not any source for the grammar and target was specified")
        exit(-1)
    else:
        rospy.loginfo("Loading grammar and target from '{}'".format(challenge))
        knowledge = knowledge_loader.load_knowledge(challenge)
        grammar = knowledge.grammar
        command_target = knowledge.grammar_target

    rospy.loginfo("Starting conversation engine with robot {}".format(robot))
    conv_engine = ConversationEngine(robot, grammar, command_target=command_target)

    rospy.loginfo("Conversation engine started")
    rospy.spin()
